<!DOCTYPE html>
{% load static %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>
    <link rel="icon" type="image/icon" href="https://grupohitec.com/wp-content/uploads/2021/09/favicon.ico"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">   
    <link href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cotizadorhitecpretest.z13.web.core.windows.net/edicionCliente.css">   
    
</head>
<body>
    <nav class="navbar navbar-expand-lg sticky-top bg-black" style="padding: 0px;">
        <div class="container-fluid">
          <a class="navbar-brand" style="padding: 0px;" href="/"><img src="https://cotizadorhitecpretest.z13.web.core.windows.net/logoCDR.png" height="70px"><!--<img src="https://grupohitec.com/wp-content/uploads/2021/06/GRUPO-HITEC.svg" height="50px">--></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <a class="nav-link active" style="padding-top: 0px; padding-bottom: 0px;" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" style="padding-top: 0px; padding-bottom: 0px;" href="#">Clientes</a>
              </li>
            </ul>
            <div class="btn-group ml-auto dropleft">
            </div>
          </div>
        </div>
      </nav>
      <div class="container py-4">
        {% block body %}
        {% endblock %}
      </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script async src="https://cdn.jsdelivr.net/npm/es-module-shims@1/dist/es-module-shims.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="importmap">
    {
      "imports": {
        "@popperjs/core": "https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/esm/popper.min.js",
        "bootstrap": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.esm.min.js"
      }
    }
    </script>
    <script type="module">
      import * as bootstrap from 'bootstrap'

      new bootstrap.Popover(document.getElementById('popoverButton'))
      
    </script>
    <script>
      $(document).ready(function () {

            $('#clientes-table').DataTable( {
        "language": {
    "processing": "Procesando...",
    "lengthMenu": "Mostrar _MENU_ registros",
    "zeroRecords": "No se encontraron resultados",
    "emptyTable": "Ningún dato disponible en esta tabla",
    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
    "search": "Buscar:",
    "loadingRecords": "Cargando...",
    "paginate": {
        "first": "Primero",
        "last": "Último",
        "next": "Siguiente",
        "previous": "Anterior"
    },
    "aria": {
        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
        "sortDescending": ": Activar para ordenar la columna de manera descendente"
    },
    "buttons": {
        "copy": "Copiar",
        "colvis": "Visibilidad",
        "collection": "Colección",
        "colvisRestore": "Restaurar visibilidad",
        "copyKeys": "Presione ctrl o u2318 + C para copiar los datos de la tabla al portapapeles del sistema. <br \/> <br \/> Para cancelar, haga clic en este mensaje o presione escape.",
        "copySuccess": {
            "1": "Copiada 1 fila al portapapeles",
            "_": "Copiadas %ds fila al portapapeles"
        },
        "copyTitle": "Copiar al portapapeles",
        "csv": "CSV",
        "excel": "Excel",
        "pageLength": {
            "-1": "Mostrar todas las filas",
            "_": "Mostrar %d filas"
        },
        "pdf": "PDF",
        "print": "Imprimir",
        "renameState": "Cambiar nombre",
        "updateState": "Actualizar",
        "createState": "Crear Estado",
        "removeAllStates": "Remover Estados",
        "removeState": "Remover",
        "savedStates": "Estados Guardados",
        "stateRestore": "Estado %d"
    },
    "autoFill": {
        "cancel": "Cancelar",
        "fill": "Rellene todas las celdas con <i>%d<\/i>",
        "fillHorizontal": "Rellenar celdas horizontalmente",
        "fillVertical": "Rellenar celdas verticalmente"
    },
    "decimal": ",",
    "searchBuilder": {
        "add": "Añadir condición",
        "button": {
            "0": "Constructor de búsqueda",
            "_": "Constructor de búsqueda (%d)"
        },
        "clearAll": "Borrar todo",
        "condition": "Condición",
        "conditions": {
            "date": {
                "before": "Antes",
                "between": "Entre",
                "empty": "Vacío",
                "equals": "Igual a",
                "notBetween": "No entre",
                "not": "Diferente de",
                "after": "Después",
                "notEmpty": "No Vacío"
            },
            "number": {
                "between": "Entre",
                "equals": "Igual a",
                "gt": "Mayor a",
                "gte": "Mayor o igual a",
                "lt": "Menor que",
                "lte": "Menor o igual que",
                "notBetween": "No entre",
                "notEmpty": "No vacío",
                "not": "Diferente de",
                "empty": "Vacío"
            },
            "string": {
                "contains": "Contiene",
                "empty": "Vacío",
                "endsWith": "Termina en",
                "equals": "Igual a",
                "startsWith": "Empieza con",
                "not": "Diferente de",
                "notContains": "No Contiene",
                "notStartsWith": "No empieza con",
                "notEndsWith": "No termina con",
                "notEmpty": "No Vacío"
            },
            "array": {
                "not": "Diferente de",
                "equals": "Igual",
                "empty": "Vacío",
                "contains": "Contiene",
                "notEmpty": "No Vacío",
                "without": "Sin"
            }
        },
        "data": "Data",
        "deleteTitle": "Eliminar regla de filtrado",
        "leftTitle": "Criterios anulados",
        "logicAnd": "Y",
        "logicOr": "O",
        "rightTitle": "Criterios de sangría",
        "title": {
            "0": "Constructor de búsqueda",
            "_": "Constructor de búsqueda (%d)"
        },
        "value": "Valor"
    },
    "searchPanes": {
        "clearMessage": "Borrar todo",
        "collapse": {
            "0": "Paneles de búsqueda",
            "_": "Paneles de búsqueda (%d)"
        },
        "count": "{total}",
        "countFiltered": "{shown} ({total})",
        "emptyPanes": "Sin paneles de búsqueda",
        "loadMessage": "Cargando paneles de búsqueda",
        "title": "Filtros Activos - %d",
        "showMessage": "Mostrar Todo",
        "collapseMessage": "Colapsar Todo"
    },
    "select": {
        "cells": {
            "1": "1 celda seleccionada",
            "_": "%d celdas seleccionadas"
        },
        "columns": {
            "1": "1 columna seleccionada",
            "_": "%d columnas seleccionadas"
        },
        "rows": {
            "1": "1 fila seleccionada",
            "_": "%d filas seleccionadas"
        }
    },
    "thousands": ".",
    "datetime": {
        "previous": "Anterior",
        "hours": "Horas",
        "minutes": "Minutos",
        "seconds": "Segundos",
        "unknown": "-",
        "amPm": [
            "AM",
            "PM"
        ],
        "months": {
            "0": "Enero",
            "1": "Febrero",
            "10": "Noviembre",
            "11": "Diciembre",
            "2": "Marzo",
            "3": "Abril",
            "4": "Mayo",
            "5": "Junio",
            "6": "Julio",
            "7": "Agosto",
            "8": "Septiembre",
            "9": "Octubre"
        },
        "weekdays": {
            "0": "Dom",
            "1": "Lun",
            "2": "Mar",
            "4": "Jue",
            "5": "Vie",
            "3": "Mié",
            "6": "Sáb"
        },
        "next": "Próximo"
    },
    "editor": {
        "close": "Cerrar",
        "create": {
            "button": "Nuevo",
            "title": "Crear Nuevo Registro",
            "submit": "Crear"
        },
        "edit": {
            "button": "Editar",
            "title": "Editar Registro",
            "submit": "Actualizar"
        },
        "remove": {
            "button": "Eliminar",
            "title": "Eliminar Registro",
            "submit": "Eliminar",
            "confirm": {
                "_": "¿Está seguro de que desea eliminar %d filas?",
                "1": "¿Está seguro de que desea eliminar 1 fila?"
            }
        },
        "error": {
            "system": "Ha ocurrido un error en el sistema (<a target=\"\\\" rel=\"\\ nofollow\" href=\"\\\">Más información&lt;\\\/a&gt;).<\/a>"
        },
        "multi": {
            "title": "Múltiples Valores",
            "restore": "Deshacer Cambios",
            "noMulti": "Este registro puede ser editado individualmente, pero no como parte de un grupo.",
            "info": "Los elementos seleccionados contienen diferentes valores para este registro. Para editar y establecer todos los elementos de este registro con el mismo valor, haga clic o pulse aquí, de lo contrario conservarán sus valores individuales."
        }
    },
    "info": "Mostrando _START_ a _END_ de _TOTAL_ registros",
    "stateRestore": {
        "creationModal": {
            "button": "Crear",
            "name": "Nombre:",
            "order": "Clasificación",
            "paging": "Paginación",
            "select": "Seleccionar",
            "columns": {
                "search": "Búsqueda de Columna",
                "visible": "Visibilidad de Columna"
            },
            "title": "Crear Nuevo Estado",
            "toggleLabel": "Incluir:",
            "scroller": "Posición de desplazamiento",
            "search": "Búsqueda",
            "searchBuilder": "Búsqueda avanzada"
        },
        "removeJoiner": "y",
        "removeSubmit": "Eliminar",
        "renameButton": "Cambiar Nombre",
        "duplicateError": "Ya existe un Estado con este nombre.",
        "emptyStates": "No hay Estados guardados",
        "removeTitle": "Remover Estado",
        "renameTitle": "Cambiar Nombre Estado",
        "emptyError": "El nombre no puede estar vacío.",
        "removeConfirm": "¿Seguro que quiere eliminar %s?",
        "removeError": "Error al eliminar el Estado",
        "renameLabel": "Nuevo nombre para %s:"
    },
    "infoThousands": "."
} 
    } );
        });

        urlBase =  document.URL.split("/");
        if(document.URL == urlBase[0] + "//" + urlBase[2] + "/") {
            Swal.fire(

                {
                    title: document.title,
                    text: 'Clientes Cargados',
                    imageUrl: 'https://grupohitec.com/wp-content/uploads/2021/06/GRUPO-HITEC.svg',
                    imageWidth: 300,
                    imageHeight: 100
                }
                )  
        }
        /*if(document.URL == urlBase[0] + "//" + urlBase[2] + "/buscarCliente/" && document.getElementById('Busqueda').value != ''){
            Swal.fire(
                document.title,
                'Búsqueda finalizada con la palabra: <b>' + document.getElementById('Busqueda').value + '</b>',
                'success'
                )  
        } else if(document.URL == urlBase[0] + "//" + urlBase[2] + "/") {
            Swal.fire(

                {
                    title: document.title,
                    text: 'Clientes Cargados',
                    imageUrl: 'https://grupohitec.com/wp-content/uploads/2021/06/GRUPO-HITEC.svg',
                    imageWidth: 300,
                    imageHeight: 100
                }
                )  
        }*/
        
        let rutaVista = "../../../";
        let vista = document.getElementById('vista').value;
        let idRegistro = document.getElementById('idRegistro').value;
        let idPais = document.getElementById('idPais').value;
        let pais = document.getElementById('Pais').value;
        let idRegion = document.getElementById('idRegion').value;
        let region = document.getElementById('Region').value;
        let idCodDomFis = document.getElementById('idCodDomFis').value;
        let idCodPos = document.getElementById('idCodPos').value;
        let iniDistrito = document.getElementById('iniDistrito').value;
        let coddomfis = document.getElementById('CodDomFis').value;

window.addEventListener("load", async () => {
    await cargaInicial();
});

const cargaInicial = async() => {
    await ListarPaises();
    await ListarEstados(idPais, true);
    console.log(idRegistro);
    if(idPais=="MX") {
        await ListarCodPos(idRegion, true);
        if(idRegistro > 0) {
            await ListarColonias(idCodPos, true);   }
    }

    PaisRegion.addEventListener("change", (event) => {

        let tagNac = document.getElementById('dataNac');
        let tagInt = document.getElementById('dataInt');
        var tagUS = false
        if(vista=="Cliente") {
            tagUS = document.getElementById('dataUS');  }

        if(event.target.value != "MX") {
            tagNac.setAttribute("hidden", true);
            tagInt.removeAttribute("hidden");
            if(vista=="Cliente") {
                if(event.target.value == "US") {
                    tagUS.removeAttribute("hidden"); }                
                else {
                    tagUS.setAttribute("hidden", true); }
            }
        }
        else {
            tagInt.setAttribute("hidden", true);
            tagNac.removeAttribute("hidden");
        }
        ListarEstados(event.target.value, false);   
    });

    Estado.addEventListener("change", (event) => {
        ListarCodPos(event.target.value);
        clearColonias();
    });

    CodigoPostal.addEventListener("change", (event) => {
        ListarColonias(event.target.value);
    });
};

const ListarPaises = async() => {
    try {
        const response = await fetch(`${rutaVista}paises/`);
        const data = await response.json();
        console.log(data);
        if(data.message == "Success") {
            opciones = `<option value='${idPais}'>${pais}</option>`;
            data.paises.forEach((pais)=> {
                opciones += `<option value='${pais.CodeId}'>${pais.Descrip}</option>`;
            });
            PaisRegion.innerHTML = opciones;
        }
        else {
            alert("Países no encontrados");
        }

    } catch (error) {
        console.log(error);
    }
};

const ListarEstados = async(idPais, inival) => {
    let opciones = ``;
    try {
        const response = await fetch(`${rutaVista}estados/${idPais}`);
        const data = await response.json();
        console.log(data);
        if(data.message == "Success") {            
            if (inival) {
                opciones = `<option value='${idRegion}'>${region}</option>`;
            } else {
                if(idPais=="MX") {
                    opciones = `<option value='CMX'>Ciudad de México</option>`;
                    ListarCodPos('CMX');
                }    
            }

            estados = data.estados;
            estados.forEach((estado)=> {
                opciones += `<option value='${estado.CodeId}'>${estado.Descrip}</option>`;
            });
            Estado.innerHTML = opciones;

            if(vista=='Cliente') {
                if(idPais=="US") {
                    CodigoDomFiscal.innerHTML = opciones;   }
                else {
                    opciones = ``;
                    CodigoDomFiscal.innerHTML = opciones;   }
            }
        }
        else {
            Estado.innerHTML = opciones;
            alert("Estados no encontrados");
        }
    } catch (error) {
        console.log(error);
    }
};

const ListarCodPos = async(idRegion, inival) => {
    try {
        const response = await fetch(`${rutaVista}codigos/${idRegion}`);
        const data = await response.json();
        console.log(data);
        if(data.message == "Success") {
            let opciones = ``;
            if(inival) {
                if( idCodPos != "")
                opciones = `<option value='${idCodPos}'>${idCodPos}</option>`;            
            }
            codigos = data.codigos;
            codigos.forEach((codigo)=> {
                opciones += `<option value='${codigo.D_codigo}'>${codigo.D_codigo}</option>`;
            });
            CodigoPostal.innerHTML = opciones;
        }
        else {
            if(!inival)
                alert("Códigos Postales no encontrados");
        }

    } catch (error) {
        console.log(error); }
};

const ListarColonias = async(CodPos, inival) => {
    try {
        const response = await fetch(`${rutaVista}colonias/${CodPos}`);
        const data = await response.json();
        console.log(data);
        var counter=0;
        if(data.message == "Success") {
            let opciones = ``;
            if (inival) {
                if( iniDistrito != "")
                opciones = `<option value='${iniDistrito}'>${iniDistrito}</option>`;
            }
            colonias = data.colonias;
            colonias.forEach((colonia)=> {
                if(counter==0)
                    mnpio = colonia.D_mnpio;
                opciones += `<option value='${colonia.D_asenta}'>${colonia.D_asenta}</option>`;
            });
            Distrito.innerHTML = opciones;
            getCiudad(mnpio);
        }
        else {
            alert("Colonias no encontrados");
        }

    } catch (error) {
        console.log(error);
    }
};

const clearColonias = async() => {
    let opciones = ``;
    Distrito.innerHTML = opciones;
    getCiudad("")
};

const clearInternacional = async() => {
    $("#IntCodigoPostal").val("");
    $("#IntCiudad").val("");
    $("#IntDistrito").val("");
};

const clearNacional = async() => {
    let opciones = ``;
    CodigoPostal.innerHTML = opciones;
    Distrito.innerHTML = opciones;
    $("#Ciudad").val("");
};

const getCiudad = async(mnpio) => {
    $("#Ciudad").val(mnpio);
};

</script>
<script>
  const form = document.getElementById('formBusqueda');
  //document.getElementById('btnBuscar').disabled = true;
  
  function validaFormulario(){
      let nombreBusqueda = document.getElementById('Busqueda').value;

      if(nombreBusqueda.length == 0 || nombreBusqueda.length == '') {
          document.getElementById('btnBuscar').disabled = true;
      } else {
          document.getElementById('btnBuscar').disabled = false;
      }

      
  }
  
  
  
  </script>
</body>
</html>